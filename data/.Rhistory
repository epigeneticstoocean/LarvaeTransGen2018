axis.ticks.y = element_blank(),                      # hide left/right axis ticks
axis.text.y = element_text(margin = margin(r = 0)),  # move left axis labels closer to axis
panel.spacing = unit(0.7, "mm"),                    # remove spacing between facets
strip.background = element_rect(size = 0.5), axis.text.x=element_text(angle=90),plot.title = element_text(size=10, hjust = 0.5))
#not fixed below
ggplot(LarvByJarVarVizDat, aes(y=LarvaeAreaum2,x=MaleIDPlain, color=JarTrt))+
geom_boxplot(alpha=0.5, position="identity") +
facet_grid(~FemIDPlain, scale="free_x")+
labs(x = "Male ID", y= expression(paste("Surface Area (", mu, m^2,")")), title = "Female ID") +
scale_color_manual(name = "Larval Treatment", labels = c("Control", "OA"), values = c("#00BFC4", "#F8766D"))+
theme_classic() +
theme(axis.title.y.right = element_blank(),                # hide right axis title
axis.text.y.right = element_blank(),                 # hide right axis labels
axis.ticks.y = element_blank(),                      # hide left/right axis ticks
axis.text.y = element_text(margin = margin(r = 0)),  # move left axis labels closer to axis
panel.spacing = unit(0.7, "mm"),                    # remove spacing between facets
strip.background = element_rect(size = 0.5), axis.text.x=element_text(angle=90),plot.title = element_text(size=10, hjust = 0.5))
ggplot(LarvByJarVarVizDat, aes(y=LarvaeDiamum ,x=MaleIDPlain, color=JarTrt))+
geom_boxplot(alpha=0.5, position="identity") +
facet_grid(~FemIDPlain, scale="free_x")+
labs(x = "Male ID", y= expression(paste("Length (", mu, "m)")), title = "Female ID") +
scale_color_manual(name = "Larval Treatment", labels = c("Control", "OA"), values = c("#00BFC4", "#F8766D"))+
theme_classic() +
theme(axis.title.y.right = element_blank(),                # hide right axis title
axis.text.y.right = element_blank(),                 # hide right axis labels
axis.ticks.y = element_blank(),                      # hide left/right axis ticks
axis.text.y = element_text(margin = margin(r = 0)),  # move left axis labels closer to axis
panel.spacing = unit(0.7, "mm"),                    # remove spacing between facets
strip.background = element_rect(size = 0.5), axis.text.x=element_text(angle=90),plot.title = element_text(size=10, hjust = 0.5))
ggplot(LarvByJarVarVizDat, aes(y=LarvaePerimeterum ,x=MaleIDPlain, color=JarTrt))+
geom_boxplot(alpha=0.5, position="identity") +
facet_grid(~FemIDPlain, scale="free_x")+
labs(x = "Male ID", y= expression(paste("Perimeter (", mu, "m)")), title = "Female ID") +
scale_color_manual(name = "Larval Treatment", labels = c("Control", "OA"), values = c("#00BFC4", "#F8766D"))+
theme_classic() +
theme(axis.title.y.right = element_blank(),                # hide right axis title
axis.text.y.right = element_blank(),                 # hide right axis labels
axis.ticks.y = element_blank(),                      # hide left/right axis ticks
axis.text.y = element_text(margin = margin(r = 0)),  # move left axis labels closer to axis
panel.spacing = unit(0.7, "mm"),                    # remove spacing between facets
strip.background = element_rect(size = 0.5), axis.text.x=element_text(angle=90),plot.title = element_text(size=10, hjust = 0.5))
ggplot(LarvByJarVarVizDat, aes(y=(LarvaePerimeterum/LarvaeDiamum),x=MaleIDPlain, color=JarTrt))+
geom_boxplot(alpha=0.5, position="identity") +
facet_grid(~FemIDPlain, scale="free_x")+
labs(x = "Male ID", y= paste("Perimeter:Length"), title = "Female ID") +
scale_color_manual(name = "Larval Treatment", labels = c("Control", "OA"), values = c("#00BFC4", "#F8766D"))+
geom_hline(yintercept= 3.142)+
theme_classic() +
theme(axis.title.y.right = element_blank(),                # hide right axis title
axis.text.y.right = element_blank(),                 # hide right axis labels
axis.ticks.y = element_blank(),                      # hide left/right axis ticks
axis.text.y = element_text(margin = margin(r = 0)),  # move left axis labels closer to axis
panel.spacing = unit(0.7, "mm"),                    # remove spacing between facets
strip.background = element_rect(size = 0.5), axis.text.x=element_text(angle=90),plot.title = element_text(size=10, hjust = 0.5))
# Chunk 35: SurvivalVisualization
SurvDat$ParentTrt<- factor(SurvDat$ParentTrt, levels=c("400", "2600"))
MeanSurvDat<- ddply(SurvWideDat, .(ParentTrt), numcolwise(mean, na.rm=T))
MeanSurvDat$ParentTrt<- factor(MeanSurvDat$ParentTrt, levels= c("400", "2600"))
SESurvDat<- ddply(SurvWideDat, .(ParentTrt), numcolwise(se, na.rm=T))
SESurvDat$ParentTrt<- factor(SESurvDat$ParentTrt, levels= c("400", "2600"))
#make reaction norms for survival color will be parent treatment. X will be jar treatment. Each cross will be its own line
ParTreat<- c("400"="Control-exposed Parents", "2600"="OA-exposed Parents")
LarvTreat<- c("Control"= "Control", "Exposed" = "OA-Exposed")
ggplot(SurvDat,aes(x=JarTrt, y=LarvaeSurvived, color = "black45", group= CrossID)) +
geom_rect(aes(xmin=-Inf, xmax=Inf, ymin=-Inf, ymax=Inf, fill = ParentTrt), colour=NA)+
scale_fill_manual(values =c("#B1FDFF", "#FCCECB"))+
geom_point(aes(color="black45"))+
geom_line(aes(color="black45", group=CrossID))+
scale_x_discrete(labels=LarvTreat)+
geom_errorbar(aes(ymin= LarvaeSurvived-SELarvaeSurvived, ymax=LarvaeSurvived+SELarvaeSurvived),width=0.05, position=position_dodge(0))+
labs(x = "Larvae Treatment", y = "Number of Larvae Survived") +
scale_color_manual(values="black")+
facet_grid(.~ParentTrt, labeller =labeller(ParentTrt = ParTreat))+
theme_classic() +
theme(panel.spacing = unit(0.2, "mm"),                    # remove spacing between facets
strip.background = element_rect(colour="white", fill="white"), panel.border= element_blank())
#make bar graph of survival
ggplot(data = MeanSurvDat, aes(x = ParentTrt, y = RatSurv, fill="gray45")) +
geom_bar(stat="identity", position="dodge")+
ylim(c(0,1))+
geom_hline(yintercept=1)+
geom_errorbar(aes(ymin= RatSurv-SESurvDat$RatSurv, ymax=RatSurv+SESurvDat$RatSurv),width=0.2, position=position_dodge(.9))+
labs(x = "Parent Treatment", y = "Proportion of Surviving Larvae \n (OA:Control)") +
scale_x_discrete(breaks=c("400","2600"),
labels=c("Control", "OA"))+
scale_fill_manual(values = "gray45") +
geom_text(aes(label=c("a", "a"),
position = 3,
size=2), vjust = -1)+
theme_classic()
# Chunk 36: OA:Control Survival
#get percent differences in survival.
SurvWideDat$OACont_Perc<- (SurvWideDat$MeanLarvSurvivedExp-SurvWideDat$MeanLarvSurvivedCon)/SurvWideDat$MeanLarvSurvivedCon
ggplot(LarvByJarVarVizDat, aes(y=LarvaeSurvived,x=MaleIDPlain, color=JarTrt))+
geom_boxplot(alpha=0.5, position="identity") +
facet_grid(~FemIDPlain, scale="free_x")+
labs(x = "Male ID", y= paste("Number of Surviving Larvae"), title = "Female ID") +
scale_color_manual(name = "Larval Treatment", labels = c("Control", "OA"), values = c("#00BFC4", "#F8766D"))+
theme_classic() +
theme(axis.title.y.right = element_blank(),                # hide right axis title
axis.text.y.right = element_blank(),                 # hide right axis labels
axis.ticks.y = element_blank(),                      # hide left/right axis ticks
axis.text.y = element_text(margin = margin(r = 0)),  # move left axis labels closer to axis
panel.spacing = unit(0.7, "mm"),                    # remove spacing between facets
strip.background = element_rect(size = 0.5), axis.text.x=element_text(angle=90),plot.title = element_text(size=10, hjust = 0.5))
# Chunk 37: GPD and survival
par(mfcol=c(1,1), mar= c(5.1, 5.1, 4.1, 2.1))
plot(LarvaeSurvived~MeanGPD, data=LarvByJarDat)
#get proportion surviving for each jar
LarvByJarDat$PropSurviving<- LarvByJarDat$LarvaeSurvived/1000
#get mean GPD in control conditions for each family
LarvByJarDat$MeanFamGPD<- SurvWideDat$MeanGPDCon[match(LarvByJarDat$CrossID, SurvWideDat$CrossID)]
LarvByJarDat$RatSurv<- SurvWideDat$RatSurv[match(LarvByJarDat$CrossID, SurvWideDat$CrossID)] # add the ratio of survival for each family to the larvbyjardat data frame
LarvByJarDat$RatGPD<- SurvWideDat$RatGPD[match(LarvByJarDat$CrossID, SurvWideDat$CrossID)] #add the ratio of growth pear day for each family to the larvbyjardat dataframe
LarvByJarDatConParentsConLarvae<- subset(LarvByJarDat, ParentTrt=="400" & JarTrt=="Control")
LarvByJarDatExpParentsConLarvae<- subset(LarvByJarDat, ParentTrt=="2600" & JarTrt=="Control")
LarvByJarDatConLarvae<- subset(LarvByJarDat, JarTrt=="Control")
LarvByJarDatExpLarvae<- subset(LarvByJarDat, JarTrt=="Exposed")
LarvByJarDatConParents<- subset(LarvByJarDat, ParentTrt=="400")
LarvByJarDatExpParents<- subset(LarvByJarDat, ParentTrt=="2600")
#now plot that the proportion of surviving larvae by the mean growth per day in control jars for that family
plot(PropSurviving~MeanFamGPD, data=LarvByJarDatConParentsConLarvae, col="black", pch=19, main="Control-Exposed Larvae")
points(PropSurviving~MeanFamGPD, data=LarvByJarDatExpParentsConLarvae, col="red", pch=19)
#lmer for control larvae
conlarv1<- lmer(PropSurviving~MeanFamGPD*ParentTrt + (1|FemaleID) + (1|MaleID), data=LarvByJarDatConLarvae)
conlarv1step<- step(conlarv1)
print(conlarv1step)
conlarvfin<-lmer( PropSurviving~MeanFamGPD + (1|FemaleID) + (1|MaleID), data=LarvByJarDatConLarvae)
#check assumptions
qqnorm(resid(conlarvfin))
qqline(resid(conlarvfin))
plot(conlarvfin)
acf(resid(conlarvfin))
#looks like meets all assumptions
summary(conlarvfin)
LarvByJarDatConParentsExpLarvae<- subset(LarvByJarDat, ParentTrt=="400" & JarTrt=="Exposed")
LarvByJarDatExpParentsExpLarvae<- subset(LarvByJarDat, ParentTrt=="2600" & JarTrt=="Exposed")
par(mfcol=c(1,1))
plot(PropSurviving~MeanFamGPD, data=LarvByJarDatConParentsExpLarvae, col="black", pch=19, main="OA-Exposed Larvae")
points(PropSurviving~MeanFamGPD, data=LarvByJarDatExpParentsExpLarvae, col="red", pch=19)
#lmer for exposed larvae
explarv1<- lmer(PropSurviving~MeanFamGPD*ParentTrt + (1|FemaleID) + (1|MaleID), data=LarvByJarDatExpLarvae)
explarv1step<- step(explarv1)
print(explarv1step)
explarvfin<-lmer( PropSurviving~MeanFamGPD + (1|FemaleID) + (1|MaleID), data=LarvByJarDatExpLarvae)
#check assumptions
qqnorm(resid(explarvfin))
qqline(resid(explarvfin))
plot(explarvfin)
acf(resid(explarvfin))
#looks like meets all assumptions
summary(explarvfin)
#looks like a negative slope, but I am skeptical of this approach because of how dependent the starting number of larvae was on family
#analysis of surviving larvae with the ratio of survival in OA to control
plot(RatSurv~MeanGPD, data=LarvByJarDatConParentsConLarvae, pch=19, col="black", main= "Control Larvae")
points(RatSurv~MeanGPD, data=LarvByJarDatExpParentsConLarvae, pch=19, col="red")
plot(RatSurv~MeanGPD, data=LarvByJarDatConParentsExpLarvae, pch=19, col="black", main= "Exposed Larvae")
points(RatSurv~MeanGPD, data=LarvByJarDatExpParentsExpLarvae, pch=19, col="red")
ratmod1<- lmer(RatSurv~MeanGPD*ParentTrt + (1|FemaleID)+ (1|MaleID), data=LarvByJarDatConLarvae)
ratmodstep<- step(ratmod1)
print(ratmodstep)
ratmod2<- lmer(RatSurv~MeanGPD*ParentTrt + (1|FemaleID)+ (1|MaleID), data=LarvByJarDatExpLarvae)
ratmod2step<- step(ratmod2)
print(ratmod2step)
#both control and exposed larvae select just random effects.
#or did she mean to plot by the mean GPD for families
plot(RatSurv~MeanFamGPD, data=LarvByJarDatConParentsConLarvae, pch=19, col="black", main= "Control Larvae")
points(RatSurv~MeanFamGPD, data=LarvByJarDatExpParentsConLarvae, pch=19, col="red")
plot(RatSurv~MeanFamGPD, data=LarvByJarDatConParentsExpLarvae, pch=19, col="black", main= "Exposed Larvae")
points(RatSurv~MeanFamGPD, data=LarvByJarDatExpParentsExpLarvae, pch=19, col="red")
ratmod1a<- lmer(RatSurv~MeanFamGPD*ParentTrt + (1|FemaleID)+ (1|MaleID), data=LarvByJarDatConLarvae)
ratmodstepa<- step(ratmod1a)
print(ratmodstepa)
ratmodfina<- lmer(RatSurv~MeanFamGPD+ (1|FemaleID)+ (1|MaleID), data=LarvByJarDatConLarvae)
qqnorm(resid(ratmodfina))
qqline(resid(ratmodfina))
plot(ratmodfina)
acf(resid(ratmodfina))
summary(ratmodfina)
ratmod2a<- lmer(RatSurv~MeanFamGPD*ParentTrt + (1|FemaleID)+ (1|MaleID), data=LarvByJarDatExpLarvae)
ratmod2stepa<- step(ratmod2a)
print(ratmod2stepa)
ratmod2fina<- lmer(RatSurv~MeanFamGPD + (1|FemaleID)+ (1|MaleID), data=LarvByJarDatExpLarvae)
qqnorm(resid(ratmod2fina))
qqline(resid(ratmod2fina))
plot(ratmod2fina)
acf(resid(ratmod2fina))
summary(ratmod2fina)
# Chunk 38
EPEL<- lmer(RatSurv~MeanGPD + (1|FemaleID)+ (1|MaleID), data=LarvByJarDatExpParentsExpLarvae)
EPELStep<- step(EPEL)
print(EPELStep)
EPELfin<- lmer(RatSurv~(1|FemaleID)+ (1|MaleID), data=LarvByJarDatExpParentsExpLarvae)
plot(EPELfin)
qqnorm(resid(EPELfin))
qqline(resid(EPELfin))
acf(resid(EPELfin))
#meets all assumptions
summary(EPELfin)
EPCL<- lmer(RatSurv~MeanGPD + (1|FemaleID) + (1|MaleID), data=LarvByJarDatExpParentsConLarvae)
EPCLStep<- step(EPCL)
print(EPCLStep)
EPCLfin<- lmer(RatSurv~(1|FemaleID)+ (1|MaleID), data=LarvByJarDatExpParentsConLarvae)
plot(EPCLfin)
qqnorm(resid(EPCLfin))
qqline(resid(EPCLfin))
acf(resid(EPCLfin))
#meets all assumptions
summary(EPCLfin)
CPCL<- lmer(logitTransform(RatSurv)~MeanGPD + (1|FemaleID) + (1|MaleID), data=LarvByJarDatConParentsConLarvae)
CPCLStep<- step(CPCL)
print(CPCLStep)
CPCLfin<- lmer(logitTransform(RatSurv)~(1|FemaleID)+ (1|MaleID), data=LarvByJarDatConParentsConLarvae)
plot(CPCLfin)
qqnorm(resid(CPCLfin))
qqline(resid(CPCLfin))
acf(resid(CPCLfin))
#does not meet assumption of normality, right skewed data.
#logit transformation results in errors because of the values over one.
summary(CPCLfin)
CPEL<- lmer(RatSurv~MeanGPD + (1|FemaleID) + (1|MaleID), data=LarvByJarDatConParentsExpLarvae)
CPELStep<- step(CPEL)
print(CPELStep)
CPELfin<- lmer(RatSurv~(1|FemaleID), data=LarvByJarDatConParentsExpLarvae)
plot(CPELfin)
qqnorm(resid(CPELfin))
qqline(resid(CPELfin))
acf(resid(CPELfin))
#does not meet assumption of normality, right skewed data.
#logit transformation results in errors because of the values over one.
summary(CPELfin)
# Chunk 39: RatiosSurvivalandGPD
ConFams<- subset(SurvWideDat, ParentTrt=="400")
ExpFams<- subset(SurvWideDat, ParentTrt=="2600")
#make plot and label by parent treatment
par(mfcol=c(1,1), mar=c(4,5,2.1,2.1))
plot(RatSurv~MeanGPDExp, data=ConFams, col="black", pch=19, xlim=c(-1.6,2.5), ylim=c(.6, 1.4))
points(RatSurv~MeanGPDExp, data=ExpFams, col="red", pch=19)
EPmod1<- lmer(RatSurv~MeanGPDExp+(1|FemaleID)+(1|MaleID)+(TrtTankID)+ (MaleTrtTankID), data=ExpFams)
EPmod1Step<- step(EPmod1)
print(EPmod1Step)
EPmodSurvWide<- lmer(RatSurv~MeanGPDExp*ParentTrt+ (1|FemaleID)+ (1|MaleID), data=SurvWideDat)
steppedsurvwide<- step(EPmodSurvWide)
#use a type II regression
Bothpars<- lm(RatSurv~MeanGPDExp*ParentTrt, data=SurvWideDat)
Bothpars2<-  lm(RatSurv~MeanGPDExp+ParentTrt, data=SurvWideDat)
Bothpars3<-  lm(RatSurv~MeanGPDExp, data=SurvWideDat)
Bothpars4<-  lm(RatSurv~ParentTrt, data=SurvWideDat)
AIC(Bothpars)
AIC(Bothpars2)
AIC(Bothpars3)
AIC(Bothpars4)
#all are so close, so choose the most complex
par(mfcol=c(2,2))
plot(Bothpars)
par(mfcol=c(1,1))
summary(Bothpars)
plot(EPmodfin)
qqnorm(resid(EPmodfin))
qqline(resid(EPmodfin))
acf(resid(EPmodfin))
summary(EPmodfin)
#do Type II regression with data from each parent treatment separately
#I will use an OLS method and have MeanGPDExp be the y variable because it has the largest error.
EPmodlm<- lmodel2(RatSurv~MeanGPDExp, data=ExpFams, nperm= 1000)
EPmodlmsimp<- lm(RatSurv~1, data=ExpFams)
par(mfcol=c(2,2))
plot(EPmodlm)
EPmodlmcon<- lmodel2(RatSurv~MeanGPDExp, data=ConFams, nperm=1000)
EPmodlmconsimp<- lm(RatSurv~1, data=ConFams)
plot(EPmodlmcon)
par(mfcol=c(1,1))
EPmodlm
EPmodlmcon
qqnorm(ExpFams$MeanGPDExp)
qqline(ExpFams$MeanGPDExp)
qqnorm(ExpFams$RatSurv)
qqline(ExpFams$RatSurv)
qqnorm(ConFams$MeanGPDExp)
qqline(ConFams$MeanGPDExp)
qqnorm(ConFams$RatSurv)
qqline(ConFams$RatSurv)
EPmod2<- lmer(RatSurv~MeanGPDCon*ParentTrt+(1|FemaleID)+(1|MaleID), data=SurvWideDat)
EPmod2Step<- step(EPmod2)
print(EPmod2Step)
EPmod2fin<- lmer(RatSurv~ (1|FemaleID), data=SurvWideDat)
plot(EPmod2fin)
qqnorm(resid(EPmod2fin))
qqline(resid(EPmod2fin))
acf(resid(EPmod2fin))
summary(EPmod2fin)
plot(MeanGPDExp~MeanGPDCon, data=SurvWideDat, pch=19)
plot(MeanLarvSurvivedExp~MeanLarvSurvivedCon, data=SurvWideDat, pch=19)
plot(RatSurv~MeanGPDCon, data=ConFams, pch=19, xlim=c(-1.5, 5.5), ylim=c(0.6, 1.5))
points(RatSurv~MeanGPDCon, data=ExpFams, pch=19, col="pink")
par(mar=c(5,6,1,1), mfrow=c(1,1))
plot(RatSurv~MeanGPDExp, data=ConFams, pch=19, col="#007367", xlim=c(-2, 2.4), ylim=c(0.6, 1.4), xlab= expression(paste("Mean Family Growth (", mu, "m/day)")), ylab="Proportion of Surviving Larvae \n (OA:Control)")
arrows(x0=(SurvWideDat$MeanGPDExp-SurvWideDat$SEMeanGPDCExp), x1= (SurvWideDat$MeanGPDExp+SurvWideDat$SEMeanGPDCExp), y0 = SurvWideDat$RatSurv, y1= SurvWideDat$RatSurv, code=3, angle=90, len=.1)
points(RatSurv~MeanGPDExp, data=ConFams, pch=19, col="#007367")
points(RatSurv~MeanGPDExp, data=ExpFams, pch=19, col="#F98880")
par(xpd=TRUE)
legend.enhanced("topright",
c("Control", "OA-exposed"),
pch=19,
col=c("#007367","#F98880"),
bty="n",
title="Parent Treatment",
horiz=TRUE,
y.intersp=.7,
x.intersp=0.5,
title.adj=c(.5,0),
title.col="black",
seg.len =1,
cex=.7,
yjust=0.5,
text.font = NULL,
inset = c(0,-.15)
)
# Chunk 40: Egg size vs. growth per day
#get data just in exposed larvae conditions for control parents
ExpLarConParByJar<- subset(LarvByJarDatConParents, JarTrt=="Exposed")
ExpLarExpParByJar<- subset(LarvByJarDatExpParents, JarTrt=="Exposed")
Eggmodlm<- lmodel2(MeanGPD~EggDiamum, data=ExpLarConParByJar, nperm=1000)
Eggmodlmsimp<- lm(MeanGPD~1, data=ExpLarConParByJar)
par(mfcol=c(2,2))
plot(Eggmodlm)
Eggmodlmexp<- lmodel2(MeanGPD~EggDiamum, data=ExpLarExpParByJar, nperm=1000)
Eggmodlmexpsimp<- lm(MeanGPD~1, data=ExpLarExpParByJar)
plot(EPmodlmcon)
par(mfcol=c(1,1), xpd=FALSE)
Eggmodlm
Eggmodlmexp
#plot the egg diameter and growth per day data
plot(MeanGPD~EggDiamum, data=ExpLarExpParByJar, ylim=c(-2, 3), pch=19)
points(MeanGPD~EggDiamum, data=ExpLarConParByJar, pch=19, col="red")
hist(ExpLarExpParByJar$EggDiamum)
qqnorm(ExpLarExpParByJar$EggDiamum)
qqline(ExpLarExpParByJar$EggDiamum)
hist(ExpLarExpParByJar$MeanGPD)
qqnorm(ExpLarConParByJar$EggDiamum)
qqline(ExpLarConParByJar$EggDiamum)
hist(ExpLarConParByJar$MeanGPD)
# Chunk 41: ExportFigures
plots.dir.path<- list.files(tempdir(), pattern="rs-graphics", full.names= TRUE)
plots.png.paths<- list.files(plots.dir.path, pattern=".png", full.names=TRUE)
file.copy(from=plots.png.paths, to="../results")
# Chunk 42: t-tests
#get Bonferoni adjusted p-crit:
0.05/10
Lexp<- subset(LarvaeDat, JarTrt=="Exposed")
Lcon<- subset(LarvaeDat, JarTrt=="Control")
t.test(GrowthPerDay~ParentTrt, data=Lexp, var.equal=TRUE)
t.test(GrowthPerDay~ParentTrt, data=Lcon, var.equal=TRUE)
t.test(LarvaeDiamum~ParentTrt, data=Lexp, var.equal=TRUE)
t.test(LarvaeDiamum~ParentTrt, data=Lcon, var.equal=TRUE)#not significantly different for control larvae
t.test(sqrt(LarvaeAreaum2)~ParentTrt, data=Lexp, var.equal=TRUE)
t.test(sqrt(LarvaeAreaum2)~ParentTrt, data=Lcon, var.equal=TRUE) #not significantly different for control larvae
t.test(LarvaePerimeterum~ParentTrt, data=Lexp, var.equal=TRUE)
t.test(LarvaePerimeterum~ParentTrt, data=Lcon, var.equal=TRUE) #not significantly different for control larvae
t.test(PerimLenRat~ParentTrt, data=Lexp, var.equal=TRUE)
t.test(PerimLenRat~ParentTrt, data=Lcon, var.equal=TRUE)#not significantly different for control larvae
# Chunk 43: Test Protocol versions
#1 subset the data by protocol
Prot1<- subset(LarvByJarDat, ProtocolVersion == "1")
Prot2<- subset(LarvByJarDat, ProtocolVersion != "1")
SurvDatProt1<- ddply(Prot1, .(CrossID, ParentTrt, JarTrt, MaleID, FemaleID, TrtTankID,MaleTrtTankID, AccTankID, Block), numcolwise(mean, na.rm=TRUE))
SESurvDatProt1<- ddply(Prot1, .(CrossID, ParentTrt, JarTrt, Block), numcolwise(se, na.rm=TRUE)) #get the standard errors for each mean count
SESurvDatProt1<- subset(SESurvDatProt1, select= c(CrossID, JarTrt, LarvaeSurvived, SatArag_ATDIC, JarSatArg_Total, MeanGPD)) #select only certain columns.
colnames(SESurvDatProt1)<- paste("SE", colnames(SESurvDatProt1), sep="")
#merge the standard error data to the SurvDat dataframe
SurvDatProt1<- merge(SurvDatProt1, SESurvDatProt1, by.x= c("CrossID", "JarTrt"), by.y= c("SECrossID", "SEJarTrt"))
#only keep the relevant fields because otherwise this is a huge data frame
SurvDatProt1<- subset(SurvDatProt1, select= c(CrossID, JarTrt, ParentTrt, MaleID, FemaleID, TrtTankID,MaleTrtTankID, AccTankID, LarvaeSurvived, Block, SELarvaeSurvived, SatArag_ATDIC, MeanGPD, SEMeanGPD))
SurvDatProt1<- subset(SurvDatProt1, Block=="B1" & CrossID !="")
#use the spread function to go from long form to wide form for the survival data
SurvDatToWideProt1<- unite(SurvDatProt1, Value, c(LarvaeSurvived, SELarvaeSurvived, MeanGPD, SEMeanGPD), sep="_")
SurvWideDatProt1<- spread(SurvDatToWideProt1, JarTrt, value= Value)
#now split the mean and SE apart again
SurvWideDatProt1<- separate(SurvWideDatProt1, Control, into= c("MeanLarvSurvivedCon", "SELarvSurvivedCon", "MeanGPDCon", "SEMeanGPDCon"), sep="_")
SurvWideDatProt1<- separate(SurvWideDatProt1, Exposed, into= c("MeanLarvSurvivedExp", "SELarvSurvivedExp", "MeanGPDExp", "SEMeanGPDCExp"), sep="_")
#make the means and ses numeric
SurvWideDatProt1$MeanLarvSurvivedExp<- as.numeric(SurvWideDatProt1$MeanLarvSurvivedExp)
SurvWideDatProt1$MeanLarvSurvivedCon<- as.numeric(SurvWideDatProt1$MeanLarvSurvivedCon)
SurvWideDatProt1$SELarvSurvivedExp<- as.numeric(SurvWideDatProt1$SELarvSurvivedExp)
SurvWideDatProt1$SELarvSurvivedCon<- as.numeric(SurvWideDatProt1$SELarvSurvivedCon)
SurvWideDatProt1$MeanGPDCon<- as.numeric(SurvWideDatProt1$MeanGPDCon)
SurvWideDatProt1$MeanGPDExp<- as.numeric(SurvWideDatProt1$MeanGPDExp)
SurvWideDatProt1$SEMeanGPDCon<- as.numeric(SurvWideDatProt1$SEMeanGPDCon)
SurvWideDatProt1$SEMeanGPDCExp<- as.numeric(SurvWideDatProt1$SEMeanGPDCExp)
SurvWideDatProt1$RatSurv<- SurvWideDatProt1$MeanLarvSurvivedExp/SurvWideDatProt1$MeanLarvSurvivedCon
SurvWideDatProt1$RatGPD<- SurvWideDatProt1$MeanGPDExp/SurvWideDatProt1$MeanGPDCon
SurvWideDatProt1$SurvChange<- (SurvWideDatProt1$MeanLarvSurvivedCon-SurvWideDatProt1$MeanLarvSurvivedExp)/SurvWideDatProt1$MeanLarvSurvivedCon
SurvWideDatProt1$CrossID<- as.factor(SurvWideDatProt1$CrossID)
SurvWideDatProt1$FemaleID<- as.factor(SurvWideDatProt1$FemaleID)
SurvWideDatProt1$MaleID<- as.factor(SurvWideDatProt1$MaleID)
SurvDatProt2<- ddply(Prot2, .(CrossID, ParentTrt, JarTrt, MaleID, FemaleID, TrtTankID,MaleTrtTankID, AccTankID, Block), numcolwise(mean, na.rm=TRUE))
SESurvDatProt2<- ddply(Prot2, .(CrossID, ParentTrt, JarTrt, Block), numcolwise(se, na.rm=TRUE)) #get the standard errors for each mean count
SESurvDatProt2<- subset(SESurvDatProt2, select= c(CrossID, JarTrt, LarvaeSurvived, SatArag_ATDIC, JarSatArg_Total, MeanGPD)) #select only certain columns.
colnames(SESurvDatProt2)<- paste("SE", colnames(SESurvDatProt2), sep="")
#merge the standard error data to the SurvDat dataframe
SurvDatProt2<- merge(SurvDatProt2, SESurvDatProt2, by.x= c("CrossID", "JarTrt"), by.y= c("SECrossID", "SEJarTrt"))
#only keep the relevant fields because otherwise this is a huge data frame
SurvDatProt2<- subset(SurvDatProt2, select= c(CrossID, JarTrt, ParentTrt, MaleID, FemaleID, TrtTankID,MaleTrtTankID, AccTankID, LarvaeSurvived, Block, SELarvaeSurvived, SatArag_ATDIC, MeanGPD, SEMeanGPD))
SurvDatProt2<- subset(SurvDatProt2, Block=="B1" & CrossID !="")
#use the spread function to go from long form to wide form for the survival data
SurvDatToWideProt2<- unite(SurvDatProt2, Value, c(LarvaeSurvived, SELarvaeSurvived, MeanGPD, SEMeanGPD), sep="_")
SurvWideDatProt2<- spread(SurvDatToWideProt2, JarTrt, value= Value)
#now split the mean and SE apart again
SurvWideDatProt2<- separate(SurvWideDatProt2, Control, into= c("MeanLarvSurvivedCon", "SELarvSurvivedCon", "MeanGPDCon", "SEMeanGPDCon"), sep="_")
SurvWideDatProt2<- separate(SurvWideDatProt2, Exposed, into= c("MeanLarvSurvivedExp", "SELarvSurvivedExp", "MeanGPDExp", "SEMeanGPDCExp"), sep="_")
#make the means and ses numeric
SurvWideDatProt2$MeanLarvSurvivedExp<- as.numeric(SurvWideDatProt2$MeanLarvSurvivedExp)
SurvWideDatProt2$MeanLarvSurvivedCon<- as.numeric(SurvWideDatProt2$MeanLarvSurvivedCon)
SurvWideDatProt2$SELarvSurvivedExp<- as.numeric(SurvWideDatProt2$SELarvSurvivedExp)
SurvWideDatProt2$SELarvSurvivedCon<- as.numeric(SurvWideDatProt2$SELarvSurvivedCon)
SurvWideDatProt2$MeanGPDCon<- as.numeric(SurvWideDatProt2$MeanGPDCon)
SurvWideDatProt2$MeanGPDExp<- as.numeric(SurvWideDatProt2$MeanGPDExp)
SurvWideDatProt2$SEMeanGPDCon<- as.numeric(SurvWideDatProt2$SEMeanGPDCon)
SurvWideDatProt2$SEMeanGPDCExp<- as.numeric(SurvWideDatProt2$SEMeanGPDCExp)
SurvWideDatProt2$RatSurv<- SurvWideDatProt2$MeanLarvSurvivedExp/SurvWideDatProt2$MeanLarvSurvivedCon
SurvWideDatProt2$RatGPD<- SurvWideDatProt2$MeanGPDExp/SurvWideDatProt2$MeanGPDCon
SurvWideDatProt2$SurvChange<- (SurvWideDatProt2$MeanLarvSurvivedCon-SurvWideDatProt2$MeanLarvSurvivedExp)/SurvWideDatProt2$MeanLarvSurvivedCon
SurvWideDatProt2$CrossID<- as.factor(SurvWideDatProt2$CrossID)
SurvWideDatProt2$FemaleID<- as.factor(SurvWideDatProt2$FemaleID)
SurvWideDatProt2$MaleID<- as.factor(SurvWideDatProt2$MaleID)
#stats on protocol 1 data
par(mfcol=c(1,1))
surv1_prot1<- lmer(RatSurv~ParentTrt+ (1|FemaleID)+(1|MaleID)+(1|TrtTankID)+(1|MaleTrtTankID), data=SurvWideDatProt1)
survstepFE_prot1<- step(surv1_prot1)
print(survstepFE_prot1)
survfin_prot1<- lmer(RatSurv~ (1|FemaleID), data=SurvWideDatProt1)#final model chosen by step function: RatSurv~ (1|FemaleID)
plot(survfin_prot1)
qqnorm(resid(survfin_prot1))
qqline(resid(survfin_prot1))
acf(resid(survfin_prot1))
summary(survfin_prot1)
#try to see if this is significantly different for exposed vs control larval treatment
SurvOA_prot1<- subset(SurvWideDatProt1, ParentTrt=="2600")
SurvCon_prot1<- subset(SurvWideDatProt1, ParentTrt=="400")
t.test(SurvOA_prot1$RatSurv, mu = 1, alternative = "two.sided")
t.test(SurvCon_prot1$RatSurv, mu = 1, alternative = "two.sided")
#stats for protocol 2
par(mfcol=c(1,1))
surv1_Prot2<- lmer(RatSurv~ParentTrt+ (1|FemaleID)+(1|MaleID)+(1|TrtTankID)+(1|MaleTrtTankID), data=SurvWideDatProt2)
survstepFE_Prot2<- step(surv1_Prot2)
print(survstepFE_Prot2)
#did not choose an lmer model so it is just ~1
survfin_Prot2<- lm(RatSurv~ 1, data=SurvWideDatProt2)#final model chosen by step function: RatSurv~ (1|FemaleID)
plot(survfin_Prot2)
#try to see if this is significantly different for exposed vs control larval treatment
SurvOA_Prot2<- subset(SurvWideDatProt2, ParentTrt=="2600")
SurvCon_Prot2<- subset(SurvWideDatProt2, ParentTrt=="400")
t.test(SurvOA_Prot2$RatSurv, mu = 1, alternative = "two.sided")
t.test(SurvCon_Prot2$RatSurv, mu = 1, alternative = "two.sided")
boxplot(SurvOA_Prot2$RatSurv)
SurvOA_Prot2sub<- subset(SurvOA_Prot2, CrossID != "EF06_EM02_B1_QG")
t.test(SurvOA_Prot2sub$RatSurv, mu = 1, alternative = "two.sided")
print(survstepFE_Prot2)
SurvWideDatProt2sub<- subset(SurvWideDatProt2, CrossID != "EF06_EM02_B1_QG")
surv1_Prot2sub<- lmer(RatSurv~ParentTrt+ (1|FemaleID)+(1|MaleID)+(1|TrtTankID)+(1|MaleTrtTankID), data=SurvWideDatProt2sub)
survstepFE_Prot2sub<- step(surv1_Prot2sub)
print(survstepFE_Prot2sub)
boxplot(LarvaeSurvived~JarTrt*ProtocolVersion, data=LarvByJarDat)
ggplot(ProtCheck,aes(x=CrossID, y=LarvaeSurvived, color = ProtFixed, shape= JarTrt)) +
geom_point(aes(color=ProtFixed))+
labs(x = "Family", y = "Number of Larvae Survived") +
scale_color_manual(values=c("black", "red"))+
facet_grid(.~ParentTrt, labeller =labeller(ParentTrt = ParTreat), scale="free_x" )+
theme_classic() +
theme(panel.spacing = unit(0.2, "mm"),                    # remove spacing between facets
strip.background = element_rect(colour="white", fill="white"), panel.border= element_blank())
ggplot(LarvByJarDat,aes(x=CrossID, y=LarvaeSurvived, color = ProtocolVersion, shape= JarTrt)) +
geom_point(aes(color=ProtocolVersion))+
labs(x = "Family", y = "Number of Larvae Survived") +
scale_color_manual(values=c("black", "red", "red"))+
facet_grid(.~ParentTrt, labeller =labeller(ParentTrt = ParTreat), scale="free_x" )+
theme_classic() +
theme(panel.spacing = unit(0.2, "mm"),                    # remove spacing between facets
strip.background = element_rect(colour="white", fill="white"), panel.border= element_blank())
ggplot(LarvByJarDat,aes(x=CrossID, y=LarvaeSurvived, color = ProtocolVersion, shape= JarTrt)) +
geom_point(aes(color=ProtocolVersion))+
labs(x = "Family", y = "Number of Larvae Survived") +
scale_color_manual(values=c("black", "red", "red"))+
facet_grid(.~ParentTrt, labeller =labeller(ParentTrt = ParTreat), scale="free_x" )+
theme_classic() +
theme(panel.spacing = unit(0.2, "mm"),                    # remove spacing between facets
strip.background = element_rect(colour="white", fill="white"), panel.border= element_blank(),axis.text.x = element_text(angle = 90))
207/106
anovmod<- aov(LarvaeSurvived~ProtocolVersion*JarTrt, data=LarvByJarDat)
summary(anovmod)
plot(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtocolVersion*JarTrt, data=LarvByJarDat)
plot(anovmod)
summary(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtocolVersion+JarTrt, data=LarvByJarDat)
summary(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtocolVersion*JarTrt, data=LarvByJarDat)
plot(anovmod)
LarvByJarDat$ProtFixed<- ifelse(LarvByJarDat$ProtocolVersion=="1_5", paste("2"), paste(LarvByJarDat$ProtocolVersion))
anovmod<- aov(log(LarvaeSurvived)~ProtFixed*JarTrt, data=LarvByJarDat)
summary(anovmod)
summary(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtFixed*JarTrt, data=LarvByJarDat)
plot(anovmod)
summary(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtFixed+JarTrt, data=LarvByJarDat)
summary(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtFixed+JarSatArg_Total, data=LarvByJarDat)
anovmod<- aov(log(LarvaeSurvived)~ProtFixed+JarSatArg_Total, data=LarvByJarDat)
summary(anovmod)
anovmod<- aov(log(LarvaeSurvived)~ProtFixed+JarTrt, data=LarvByJarDat)
summary(anovmod)
